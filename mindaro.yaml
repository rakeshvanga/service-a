# version: v1 # default - affects remaining schema
# workload: service # default; also job, function, etc. - affects remaining schema
# properties:
  # Simple case: single image and container
  # image:
    # credentials: # to access the base image for build or the desired image
      # username: $(env.global.registryUserName) # default, if it is present
      # password: $(env.global.registryPassword) # default, if it is present
    # Build an image from source...
    # build:
      # args: # optional
      #   arg1: value1
      # context: . # default
      # dockerfile: Dockerfile # default
      # labels: # optional
      #   label1: value1
      # target: develop # optional
    # ...or identify an existing image
    # repository: myacr.azurecr.io/foo/bar
    # tag: baz
  container:
    # image: # default is the single unnamed image
    # entrypoint: # default is the image's default entrypoint
    command: ["npm", "run", "watch"] # default is the image's default command
    # nonHttpPorts: # default is none, can be used to disable Envoy routing
    # syncTarget: # default is automatically determined for images built from source
    # keepHealthChecks: false # default, typically disabled for development
    # terminateGracefully: false # default, typically kill it during development
  # More complex case: multiple named images and containers
  # images:
  #   image2:
  #   image3:
  # containers:
  #   container1:
  #     image: image2
  #   container2:
  #     image: image2
  #   container3:
  #     image: image3
  helm: # may be other deployment mechanisms in the future
    # Which helm chart should be installed?
    # chart: chart # default
    # What additional values files should be processed beyond values.yaml?
    # values:
    # - values.dev.yaml
    # What additional inline values should be supplied?
    # Reference container image repositories and tags:
    #  - $(container.image.repository)
    #  - $(container.image.tag)
    #  - $(container.images.image2.repository)
    #  - $(container.images.image3.tag)
    # Reference global secrets:
    #  - $(secrets.global.servicePrincipalId)
    # Reference chart-specific secrets:
    #  - $(secrets.chart.redis.key)
    # Reference instance-specific secrets:
    #  - $(secrets.my-service-a.mongo.connectionString)
    set:
      image:
        repository: $(container.image.repository) # default
        tag: $(container.image.tag) # default
        pullPolicy: Never # default
      ingress:
        enabled: true
      secrets: $(secrets.chart) # default
    # Maps to the --wait option on helm install
    wait: false # default
  # How should we respond to local file changes?
  # Rules are processed in reverse order of specification, so
  # they should be defined from most general to most specific.
  # Dockerfile and ignore file changes always trigger "rebuild".
  # Any changes to the chart folder always trigger "reinstall".
  watch:
  - pattern: "package.json"
    action: rebuild # default is "sync", allowed to be "ignore", "sync" or "rebuild"
# Additional named configurations that override any of the properties above
configurations:
  debug: # Applied if you call "mindaro -c debug up"
    container:
      command: ["npm", "run", "debug", "--", "--inspect=0.0.0.0:9229"]
  debug.vs: # Applied if you call "mindaro -c debug.vs up", also applies "debug" config
  debug.vs.code: # Applied if you call "mindaro -c debug.vs.code up", also applies "debug.vs", "debug" config