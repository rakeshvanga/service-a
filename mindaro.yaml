version: v1 # affects remaining schema
workload: helm-chart # affects remaining schema
properties:
  # Simple case: single image and container
  # image:
    # credentials: # to access the base image for build or the desired image
      # username: $(secrets.global.registry.username) # default, if it is present
      # password: $(secrets.global.registry.password) # default, if it is present
    # Build an image from source...
    # build:
      # args: # optional
      #   arg1: value1
      # context: . # default
      # dockerfile: Dockerfile # default
      # labels: # optional
      #   label1: value1
      # target: develop # optional
    # ...or identify an existing image
    # repository: myacr.azurecr.io/foo/bar
    # tag: baz
  container:
    # image: # default is the single unnamed image
    # entrypoint: # default is the image's default entrypoint
    command: ["npm", "run", "watch"] # default is the image's default command
    # nonHttpPorts: # default is none, can be used to disable Envoy routing
    # syncTarget: # default is automatically determined for images built from source
    # healthChecks: false # default, typically not desirable for development
    # terminateGracefully: false # default, typically kill it during development
  # More complex case: multiple named images and containers
  # images:
  #   image2:
  #   image3:
  # containers:
  #   container1:
  #     image: image2
  #   container2:
  #     image: image2
  #   container3:
  #     image: image3
  helm:
    # Which helm chart (directory) should be installed?
    # chart: chart # default
    # What additional values files should be processed beyond values.yaml?
    # values: # optional
    # - values.dev.yaml
    # What additional values should be set?
    # Reference container image repositories and tags:
    #  - $(container.image.repository)
    #  - $(container.image.tag)
    #  - $(container.images.image2.repository)
    #  - $(container.images.image3.tag)
    # Reference global secrets:
    #  - $(secrets.global.servicePrincipalId)
    # Reference chart-specific secrets:
    #  - $(secrets.chart.redis.key)
    # Reference release-specific secrets:
    #  - $(secrets.releases.fluffy-penguin.mongo.connectionString)
    set:
      # image:
      #   repository: $(container.image.repository) # default
      #   tag: $(container.image.tag) # default
      #   pullPolicy: Never # default
      ingress:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: mindaro # creates a https dev endpoint
      # secrets: $(secrets.chart) # default
    # Maps to the --wait option on helm install
    # wait: false # default
  # How should we respond to local file changes?
  # Rules are processed in reverse order of specification, so
  # they should be defined from most general to most specific.
  # Any changes to the chart folder always trigger "reinstall".
  # Any changes to the Dockerfile or ignore files always trigger "rebuild".
  # All other changes will default to triggering a simple file "sync".
  watch:
  - pattern: "package.json"
    action: rebuild # default is "sync", allowed to be "ignore", "sync", "rebuild" or "reinstall"
# Additional named configurations that override any of the properties above
configurations:
  debug: # Applied if you call "mindaro -c debug up"
    container:
      command: ["npm", "run", "debug", "--", "--inspect=0.0.0.0:9229"]
  debug.vs: # Applied if you call "mindaro -c debug.vs up", also applies "debug" config
  debug.vs.code: # Applied if you call "mindaro -c debug.vs.code up", also applies "debug.vs", "debug" config