version: v1
properties:
  # Simple case: single image
  image:
    # Either build an image from source...
    build:
      # args:
      #   arg1: value1
      context: . # default
      dockerfile: Dockerfile # default
      # noSync: false # do not allow automatic syncTarget determination
      # labels:
      #   label1: value1
      # target: develop
    # ...or use an existing repository and tag
    # repository: myacr.azurecr.io/foo/bar
    # tag: baz # regardless of this tag, the instrumented tag will be unique
    # Remaining properties relate to dev instrumentation of the image
    # entrypoint: # default is the image's default entrypoint
    command: ["npm", "run", "watch"] # default is the image's default command
    # nonHttpPorts: # default is [], can be used to disable Envoy routing
    # syncTarget: # default is automatically determined for images built from source
    # keepHealthChecks: false # default, typically disabled for development
    # terminateGracefully: false # default, typically kill it during development
  # More complex case: multiple named images
  images:
    image2:
    image3:
  secrets:
    provider: mindaro # by default, we'll magically store secrets for you
  helm:
    # Which helm chart should be installed?
    chart: chart # default
    # What additional values files should be processed beyond values.yaml?
    # values:
    # - values.dev.yaml
    # What additional inline values should be supplied?
    # Reference instrumented image repositories and tags:
    #  - $(image.repository)
    #  - $(image.tag)
    #  - $(image.image2.repository)
    #  - $(image.image3.tag)
    # Reference secrets:
    #  - $(secrets.my.global.key)
    #  - $(env.mychart.secrets)
    set:
      image:
        repository: $(image.repository) # default
        tag: $(image.tag) # default
        pullPolicy: Never # default since image will be local
      ingress:
        enabled: true
      secrets: $(secrets.service-a) # default to "secrets.<chart-name>"
    # Maps to the --wait option on helm install
    wait: false # default
  # How should we respond to local file changes?
  # Rules are processed in reverse order of specification, so
  # they should be defined from most general to most specific.
  # Dockerfile and ignore file changes always trigger "rebuild".
  # Also changes to the chart folder always trigger "reinstall".
  watch:
  - pattern: "package.json"
    action: rebuild # default is "sync", allowed to be "ignore", "sync" or "rebuild"
# Additional named configurations that override properties above
configurations:
  debug: # Applied if you call "mindaro -c debug up"
    image:
      command: ["npm", "run", "debug", "--", "--inspect=0.0.0.0:9229"]
  debug.vs: # Applied if you call "mindaro -c debug.vs up", also applies "debug" config
  debug.vs.code: # Applied if you call "mindaro -c debug.vs.code up", also applies "debug.vs", "debug" configs